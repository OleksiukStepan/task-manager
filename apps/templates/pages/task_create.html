{% extends "layouts/base.html" %}

{% block title %}Create Task{% endblock %}

{% block content %}
  <div class="row">
  
    <!-- Main Task Creation Form -->
    <div class="col-12 col-lg-8 mb-4">
      <div class="card border-0 shadow">
        <div class="card-header">
          <h2 class="fs-5 fw-bold mb-0">Create Task</h2>
        </div>
        <div class="card-body">
          <form method="POST" action="{% url 'task_manager:task_create' %}">
            {% csrf_token %}

            <!-- Display form-wide errors -->
            {% if form.errors %}
              <div class="alert alert-danger">
                <ul class="mb-0">
                  {% for field, errors in form.errors.items %}
                    {% for error in errors %}
                      <li>{{ error }}</li>
                    {% endfor %}
                  {% endfor %}
                </ul>
              </div>
            {% endif %}
          
            <!-- Task Fields -->
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="id_name">Name:</label>
                {{ form.name }}
              </div>
              <div class="col-md-6 mb-3">
                <label for="id_deadline">Deadline:</label>
                {{ form.deadline }}
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="id_priority">Priority:</label>
                {{ form.priority }}
              </div>
              <div class="col-md-6 mb-3">
                <label for="id_task_type">Task type:</label>
                {{ form.task_type }}
              </div>
            </div>
            <div class="mb-3">
              <label for="id_description">Description:</label>
              {{ form.description }}
            </div>
            <div class="mb-3 form-check">
              {{ form.is_complete }}
              <label class="form-check-label" for="id_is_complete">Is complete</label>
            </div>
            <button type="submit" class="btn btn-primary">Save</button>
            <a href="{% url 'task_manager:task_list' %}" class="btn btn-secondary">Cancel</a>


            <!-- Members Assignment Section -->
            <div class="card border-0 shadow mt-4">
              <div class="card-header">
                <h2 class="fs-5 fw-bold mb-0">Assign Team Members</h2>
              </div>
              <div class="card-body">
                <div class="row">
                  {% if workers %}
                    {% for worker in workers %}
                      <div class="col-12 col-md-4 mb-3">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                          <div class="d-flex align-items-center">
                            {% if worker.profile_image %}
                              <img src="{{ worker.profile_image.url }}" alt="Profile Picture" class="rounded me-3" style="width: 40px; height: 40px;">
                            {% else %}
                              {% load static %}
                              <img src="{% static 'assets/img/team/default_avatar' %}" alt="Profile Picture" class="rounded me-3" style="width: 40px; height: 40px;">
                            {% endif %}
                            <div>
                              <h6 class="mb-0">{{ worker.username }}</h6>
                              {% if worker.position.name %}
                              <small class="text-muted">{{ worker.position.name }}</small>
                              {% endif %}
                            </div>
                          </div>
                          <label class="form-check-label">
                            <input type="checkbox" name="members" value="{{ worker.id }}" class="form-check-input">
                          </label>
                        </div>
                      </div>
                    {% endfor %}
                  {% else %}
                    <div class="col-12">
                      <li class="list-group-item text-muted">No team members available</li>
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>

          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}
