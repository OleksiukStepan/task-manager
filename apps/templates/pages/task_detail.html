{% extends "layouts/base.html" %}

{% block title %} Task Detail {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}
  {% load custom_filters %}
  {% load static %}

  <!-- Task Name & Description -->
  <div class="row">
    <div class="col-12 col-xl-8 mb-4">
      <div class="card border-0 shadow-lg">
        <div class="card-header bg-light text-black">
          <div class="row align-items-center">
            <div class="col">
              <h2 class="fs-4 fw-bold mb-0">
                <i class="bi bi-card-checklist me-2"></i>{{ task.name }}
              </h2>
            </div>

            <!-- Update & Delete Buttons -->
            <div class="col text-end">
              <a href="{% url 'task_manager:task_update' pk=task.id %}" class="btn btn-primary">
                Update Task
              </a>
              <a href="{% url 'task_manager:task_delete' pk=task.id %}" class="btn btn-danger">
                Delete Task
              </a>
            </div>
          </div>
        </div>

        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <h4 class="fs-5 fw-bold mb-3">Description</h4>
              <p>{{ task.description }}</p>
            </div>

            <!-- Task Details -->
            <div class="col-md-4">
              <h4 class="fs-5 fw-bold mb-3">Task Details</h4>
              <ul class="list-group list-group-flush">
                <li class="list-group-item">
                  <strong>ID: </strong>
                  <span class="fw-bolder text-gray-500">{{ task.id }}</span>
                </li>
                <li class="list-group-item">
                  <strong>Deadline:</strong>
                  <span class="fw-bolder text-gray-500">{{ task.deadline|date:"F d, Y" }}</span>
                </li>
                <li class="list-group-item">
                  <strong>Priority:</strong>
                  <span class="{{ task.priority|priority_class }}">{{ task.get_priority_display }}</span>
                </li>
                <li class="list-group-item">
                  <strong>Type:</strong>
                  <span class="fw-bolder text-gray-500">{{ task.task_type.name }}</span>
                </li>
                <li class="list-group-item">
                  <strong>Status:</strong>
                  <span class="fw-bolder {% if task.is_complete %}text-success{% else %}text-gray-500{% endif %}">
                    {{ task.is_complete|yesno:"Complete,Pending" }}
                  </span>
                </li>
                <li class="list-group-item">
                  <strong>Created:</strong>
                  <span class="fw-bolder text-gray-500">{{ task.created_at|date:"F d, Y H:i" }}</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-xl-4 mb-4">
      <div class="card border-0 shadow">
        <div class="card-header border-bottom d-flex align-items-center justify-content-between">
          <h2 class="fs-5 fw-bold mb-0">Assignees</h2>
          {% if user.is_authenticated %}
            <form action="{% url 'task_manager:task_detail' pk=task.id %}" method="post">
              {% csrf_token %}
              {% if user in task.assignees.all %}
                <button type="submit" name="Delete" class="btn btn-danger">
                  Detach Me from This Task
                </button>
              {% else %}
                <button type="submit" name="Add" class="btn btn-secondary">
                  Assign me to this task
                </button>
              {% endif %}
            </form>
          {% endif %}
        </div>

        <div class="card-body">
          <ul class="list-group list-group-flush">
            {% for worker in task.assignees.all %}
              <li class="list-group-item">
                <div class="d-flex align-items-center">
                  <!-- Photo -->
                  <div class="me-3">
                    <a href="#" class="avatar">
                      {% if worker.profile_image %}
                        <img class="rounded" alt="Profile Picture" src="{{ worker.profile_image.url }}">
                      {% else %}
                        <img class="rounded" alt="Profile Picture" src="/media/profile_images/default_avatar.jpg">
                      {% endif %}
                    </a>
                  </div>

                  <!-- Username and Status -->
                  <div>
                    <h6 class="mb-1">
                      <a href="#">{{ worker.username }}</a>
                    </h6>
                    <small class="d-flex align-items-center">
                    <span
                        class="dot rounded-circle me-1 {% if worker.is_online %}bg-success{% else %}bg-danger{% endif %}"></span>
                      {{ worker.is_online|yesno:"Online,Offline" }}
                    </small>
                  </div>
                </div>
              </li>
            {% empty %}
              <li class="list-group-item text-muted">No team members assigned</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>



{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}{% endblock javascripts %}
